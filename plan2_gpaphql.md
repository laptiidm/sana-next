
---

## üîß **–ó–∞–≥–∞–ª—å–Ω–∞ —ñ–¥–µ—è: –ß–æ–º—É –≤–∑–∞–≥–∞–ª—ñ —Ç–∞–∫–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è**

* **–ú–µ—Ç–∞:** –≥–Ω—É—á–∫–æ –ø–µ—Ä–µ–º–∏–∫–∞—Ç–∏—Å—å –º—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏ —Å—Ö–æ–≤–∏—â–∞–º–∏ (XML / –ë–î) –Ω–∞ –∑–∞–ø–∏—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –±–µ–∑ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏.
* **–ü—ñ–¥—Ö—ñ–¥:** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–∞–º –≤–∫–∞–∑—É—î —Å—Ö–æ–≤–∏—â–µ —É –∑–∞–≥–æ–ª–æ–≤–∫—É `X-Storage-Type`, –∞ –∫–æ–¥ –¥–∏–Ω–∞–º—ñ—á–Ω–æ –æ–±–∏—Ä–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π.
* **–ü–µ—Ä–µ–≤–∞–≥–∞:** –ø–æ–≤–Ω–∞ —ñ–∑–æ–ª—è—Ü—ñ—è –≤—ñ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π (`XmlTaskRepository`, `DbTaskRepository`), –∑–∞–≤–¥—è–∫–∏ DI —Ç–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º.

---

## üì¶ **–†–æ–ª—ñ —ñ –≤–∑–∞—î–º–æ–∑–≤‚Äô—è–∑–∫–∏ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏–±–æ—Ä—É —Å—Ö–æ–≤–∏—â–∞)**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                                                                    | –†–æ–ª—å                                                                                                       | –û–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è                                                                             |
| ---------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| **`StorageOptions` (–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è)**                                          | –ó–±–µ—Ä—ñ–≥–∞—î —à–ª—è—Ö–∏ –¥–æ XML / —Ä—è–¥–∫–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î + –¥–µ—Ñ–æ–ª—Ç–Ω–µ —Å—Ö–æ–≤–∏—â–µ                                         | –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å—Ö–æ–≤–∏—â —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞, –ª–µ–≥–∫–æ –∑–º—ñ–Ω–∏—Ç–∏ –±–µ–∑ –∑–º—ñ–Ω–∏ –∫–æ–¥—É                          |
| **`IXmlRepositorySettingsProvider` / `IDatabaseRepositorySettingsProvider`** | –Ü–Ω–∫–∞–ø—Å—É–ª—é—é—Ç—å –ª–æ–≥—ñ–∫—É –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π (—à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É –∞–±–æ —Ä—è–¥–æ–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è)                           | –ê–±—Å—Ç—Ä–∞–≥—É—é—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –≤—ñ–¥ –¥–∂–µ—Ä–µ–ª–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å                                           |
| **`XmlRepositorySettingsProvider` / `DbRepositorySettingsProvider`**         | –†–µ–∞–ª—ñ–∑—É—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ `IOptions<StorageOptions>`                                         | –°–µ—Ä–≤—ñ—Å–∏ –ª–µ–≥–∫–æ —Ä–µ—î—Å—Ç—Ä—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ DI                                                       |
| **`IStorageSelectionService`**                                               | –ö–æ–Ω—Ç—Ä–∞–∫—Ç, —è–∫–∏–π –æ–ø–∏—Å—É—î –≤–∏–±—ñ—Ä —Å—Ö–æ–≤–∏—â–∞ —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é                                  | –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑—É—î –ª–æ–≥—ñ–∫—É –≤–∏–±–æ—Ä—É ‚Äî –º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ –ø—ñ–¥–º—ñ–Ω–∏—Ç–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é                             |
| **`StorageSelectionService`**                                                | –†–µ–∞–ª—å–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ª–æ–≥—ñ–∫–∏ –≤–∏–±–æ—Ä—É —Å—Ö–æ–≤–∏—â–∞ ‚Äî —á–∏—Ç–∞—î –∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∞–±–æ —Å–µ—Å—ñ—ó, —ñ –ø–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π | –ì–æ–ª–æ–≤–Ω–∏–π –ø–æ—Å–µ—Ä–µ–¥–Ω–∏–∫ –º—ñ–∂ GraphQL —ñ DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º                                          |
| **`IServiceProvider`**                                                       | –î–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ (`XmlTaskRepository`, `DbTaskRepository`)                        | –ß–µ—Ä–µ–∑ DI-–∑–∞–ø–∏—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —Ç–æ–¥—ñ, –∫–æ–ª–∏ –¥—ñ–π—Å–Ω–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ (–ª–µ–Ω–∏–≤–æ)                     |
| **`HttpContextAccessor`**                                                    | –î–æ—Å—Ç—É–ø –¥–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É/—Å–µ—Å—ñ—ó ‚Äî –∑–æ–∫—Ä–µ–º–∞, –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è `X-Storage-Type`                                   | –î–æ–∑–≤–æ–ª—è—î —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó `StorageSelectionService` –±—É—Ç–∏ –Ω–µ–∑–∞–ª–µ–∂–Ω–∏–º–∏ –≤—ñ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ |

---

# –ê–ª–≥–æ—Ä–∏—Ç–º:

---

### üîÅ **–ê–ª–≥–æ—Ä–∏—Ç–º –≤–∏–±–æ—Ä—É —Å—Ö–æ–≤–∏—â–∞ (UI —á–µ—Ä–µ–∑ —Å–µ—Å—ñ—é)**

1. **üîπ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–∫—Ä–∏–≤–∞—î –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É** (`/Tasks/Index`) —É –±—Ä–∞—É–∑–µ—Ä—ñ.

2. **üîπ –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä `TasksController` –æ–±—Ä–æ–±–ª—è—î –∑–∞–ø–∏—Ç** —ñ –≤–∏–∫–ª–∏–∫–∞—î –º–µ—Ç–æ–¥ `GetCurrentRepository()` —ñ–∑ `IStorageSelectionService`.

3. **üîπ `GetCurrentRepository()` –≤–∏–∫–ª–∏–∫–∞—î `GetCurrentStorageType()`**, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫–µ —Å—Ö–æ–≤–∏—â–µ –≤–∏–±—Ä–∞–Ω–æ.

4. **üîπ `GetCurrentStorageType()` —á–∏—Ç–∞—î —Å–µ—Å—ñ—é (`HttpContext.Session`)**:

   * –Ø–∫—â–æ –≤ —Å–µ—Å—ñ—ó —î –∫–ª—é—á `CurrentStorageType`, –ø–æ–≤–µ—Ä—Ç–∞—î –π–æ–≥–æ.
   * –Ø–∫—â–æ –≤ —Å–µ—Å—ñ—ó –Ω–µ–º–∞—î —Ç–∏–ø—É —Å—Ö–æ–≤–∏—â–∞ ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —ñ–∑ `StorageOptions`.

5. **üîπ –ù–∞ –æ—Å–Ω–æ–≤—ñ —Ç–∏–ø—É —Å—Ö–æ–≤–∏—â–∞ `StorageSelectionService` –æ—Ç—Ä–∏–º—É—î —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π** (XML –∞–±–æ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö) —á–µ—Ä–µ–∑ DI (`GetRequiredService`).

6. **üîπ –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–¥–∞—á —ñ –ø–µ—Ä–µ–¥–∞—î —ó—Ö —É View.**

7. **üîπ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –∑–∞–¥–∞—á—ñ, —â–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –≤–∏–±—Ä–∞–Ω–æ–º—É —Å—Ö–æ–≤–∏—â—ñ.**

---

üîß –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É —Ñ–æ—Ä–º—ñ –≤–∏–±–∏—Ä–∞—î —ñ–Ω—à–µ —Å—Ö–æ–≤–∏—â–µ:

* –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥ `SetCurrentStorageType(...)`, —è–∫–∏–π –∑–º—ñ–Ω—é—î —Ç–∏–ø —É —Å–µ—Å—ñ—ó.
* –ü—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –Ω–æ–≤–µ —Å—Ö–æ–≤–∏—â–µ.

---

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –ø–ª–∞–≤–Ω–æ –ø–µ—Ä–µ–º–∏–∫–∞—Ç–∏—Å—è –º—ñ–∂ XML —Ç–∞ –ë–î –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–æ–¥–∞—Ç–∫—É.
*
