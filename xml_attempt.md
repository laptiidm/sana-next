–û—Å—å —Å–ø–∏—Å–æ–∫ –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å—É—Ç–Ω–æ—Å—Ç–µ–π —Ç–≤–æ–≥–æ .NET MVC –ø—Ä–æ—î–∫—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ø–∞–ø–æ–∫ –∑—ñ —Å–∫—Ä—ñ–Ω—à–æ—Ç—É —Ç–∞ –∫–æ—Ä–æ—Ç–∫—ñ –æ–ø–∏—Å–∏ —ó—Ö–Ω—ñ—Ö —Ä–æ–ª–µ–π:

---

### üìÅ **Configurations**

* **StorageOptions.cs**
  –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ –∑ –≤–∏–±–æ—Ä–æ–º —Ç–∏–ø—É —Å—Ö–æ–≤–∏—â–∞ (–ë–î –∞–±–æ XML). –ô–º–æ–≤—ñ—Ä–Ω–æ, –∑—á–∏—Ç—É—î `StorageType` –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∞–±–æ –∑ UI.

---

### üìÅ **Controllers**

* **StorageController.cs**
  –ö–µ—Ä—É—î –ª–æ–≥—ñ–∫–æ—é, –ø–æ–≤‚Äô—è–∑–∞–Ω–æ—é –∑ –≤–∏–±–æ—Ä–æ–º —Å—Ö–æ–≤–∏—â–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ drop-down –º–µ–Ω—é).

* **TaskController.cs**
  –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –¥–ª—è –∑–∞–¥–∞—á. –û–±—Ä–æ–±–ª—è—î –∑–∞–ø–∏—Ç–∏ –Ω–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è, –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–±–æ –∑–º—ñ–Ω—É –∑–∞–¥–∞—á.

---

### üìÅ **Enums**

* **StorageType.cs**
  –ü–µ—Ä–µ–ª—ñ—á–µ–Ω–Ω—è (enum), —è–∫–µ –≤–∏–∑–Ω–∞—á–∞—î —Ç–∏–ø–∏ —Å—Ö–æ–≤–∏—â: –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `Database`, `Xml`.

---

### üìÅ **Models**

* **CategoryModel.cs**
  –ú–æ–¥–µ–ª—å –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –∑–∞–¥–∞—á (–º–æ–∂–ª–∏–≤–æ, –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –∞–±–æ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è).

* **ErrorViewModel.cs**
  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –º–æ–¥–µ–ª—å –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫.

* **TaskModel.cs**
  –û—Å–Ω–æ–≤–Ω–∞ –º–æ–¥–µ–ª—å –∑–∞–¥–∞—á—ñ (–æ–ø–∏—Å, —Å—Ç–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –º–æ–∂–ª–∏–≤–æ, –¥–∞—Ç–∞ —Ç–æ—â–æ).

* **TasksViewModel.cs**
  ViewModel, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å —Å–ø–∏—Å–∫–∏ –∑–∞–¥–∞—á –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —É `Index.cshtml`, –π–º–æ–≤—ñ—Ä–Ω–æ —Ä–æ–∑–¥—ñ–ª–µ–Ω–∞ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω—ñ —Ç–∞ –Ω–µ–≤–∏–∫–æ–Ω–∞–Ω—ñ.

---

### üìÅ **Repositories**

* **ITaskRepository.cs**
  –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é –∑–∞–¥–∞—á ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ –¥–∞–Ω–∏–º–∏.

* **DBTaskRepository.cs**
  –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è `ITaskRepository` –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö.

* **XmlTaskRepository.cs**
  –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è `ITaskRepository` –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ XML-—Ñ–∞–π–ª–æ–º.

---

### üìÅ **Services**

* **IStorageSelectionService.cs**
  –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–µ—Ä–≤—ñ—Å—É, —è–∫–∏–π –∫–µ—Ä—É—î –≤–∏–±–æ—Ä–æ–º —Å—Ö–æ–≤–∏—â–∞.

* **StorageSelectionService.cs**
  –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–µ—Ä–≤—ñ—Å—É, —â–æ –¥–æ–∑–≤–æ–ª—è—î –¥–∏–Ω–∞–º—ñ—á–Ω–æ –≤–∏–±—Ä–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ —Å—Ö–æ–≤–∏—â–µ (`DB` –∞–±–æ `XML`) –Ω–∞ –æ—Å–Ω–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –∞–±–æ –≤–∏–±–æ—Ä—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

---

### üìÅ **Storage**

* **TaskListWrapper.cs**
  –ö–ª–∞—Å-–æ–±–≥–æ—Ä—Ç–∫–∞ –¥–ª—è –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó/—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å–ø–∏—Å–∫—É –∑–∞–¥–∞—á –∑ XML.

* **tasks.xml**
  XML-—Ñ–∞–π–ª, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö).

---

### üìÅ **Views**

* **Shared**
  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ø–∞–ø–∫–∞ –¥–ª—è —Å–ø—ñ–ª—å–Ω–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `_Layout`, –ø–æ–º–∏–ª–∫–∏).

* **Task/Index.cshtml**
  –û—Å–Ω–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞, —è–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –∑–∞–¥–∞—á—ñ. –ô–º–æ–≤—ñ—Ä–Ω–æ, –º–∞—î drop-down –¥–ª—è –≤–∏–±–æ—Ä—É —Å—Ö–æ–≤–∏—â–∞ —Ç–∞ —Å–ø–∏—Å–∫–∏ –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö/–Ω–µ–≤–∏–∫–æ–Ω–∞–Ω–∏—Ö –∑–∞–¥–∞—á.

---

### üîÅ **–ó–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏:**

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ `Index.cshtml` –≤–∏–±–∏—Ä–∞—î —Å—Ö–æ–≤–∏—â–µ.
2. `StorageController` –∑–±–µ—Ä—ñ–≥–∞—î –≤–∏–±—ñ—Ä —É —Å–µ—Å—ñ—ó –∞–±–æ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤—ñ—Å.
3. `TaskController` –æ—Ç—Ä–∏–º—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é `ITaskRepository` —á–µ—Ä–µ–∑ `StorageSelectionService`.
4. –î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞ (–ë–î –∞–±–æ XML).
5. `TasksViewModel` –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —É `Index.cshtml` –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É –∑–∞–¥–∞—á.

---

–¢–∞–∫, –≤–∏—Ö–æ–¥—è—á–∏ –∑ –≤–º—ñ—Å—Ç—É —Ç–≤–æ–≥–æ `Program.cs`, –æ—Å—å **—â–æ –º–∞—î –±—É—Ç–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Ç–∞ —è–∫—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –≤–∂–µ –º–∞—é—Ç—å –±—É—Ç–∏ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–ø—É—Å–∫—É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É –≤ debug-—Ä–µ–∂–∏–º—ñ**:

---

### ‚úÖ **1. –°–µ—Ä–≤—ñ—Å–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ –≤–∂–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ:**

–ù–∞ —Ü—å–æ–º—É –µ—Ç–∞–ø—ñ –≤—Å–µ, —â–æ —Ç–∏ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞–≤ —á–µ—Ä–µ–∑ `builder.Services.Add...()` ‚Äî –≤–∂–µ –≥–æ—Ç–æ–≤–µ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

#### –°–µ—Ä–≤—ñ—Å–∏:

| –°–µ—Ä–≤—ñ—Å / –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å         | –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è / –ö–æ–º–µ–Ω—Ç–∞—Ä                                                                     |
| -------------------------- | ----------------------------------------------------------------------------------------- |
| `IStorageSelectionService` | `StorageSelectionService` ‚Äì –∑—á–∏—Ç—É—î `StorageType` —ñ–∑ —Å–µ—Å—ñ—ó                                 |
| `IHttpContextAccessor`     | `HttpContextAccessor` ‚Äì –¥–æ–∑–≤–æ–ª—è—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –ø–æ—Ç–æ—á–Ω–∏–º HTTP-–∑–∞–ø–∏—Ç–æ–º (–¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–µ—Å—ñ—ó) |
| `ITaskRepository`          | `DBTaskRepository` **–∞–±–æ** `XmlTaskRepository` (–æ–±–∏—Ä–∞—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ)                     |
| `IOptions<StorageOptions>` | –û–±'—î–∫—Ç, —â–æ —Ç—Ä–∏–º–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑ `StorageOptions` —Å–µ–∫—Ü—ñ—ó –≤ `appsettings.json`                 |
| MVC (Controllers + Views)  | –î–æ—Å—Ç—É–ø–Ω—ñ —á–µ—Ä–µ–∑ `AddControllersWithViews()`                                                |
| –°–µ—Å—ñ—ó (`ISession`)         | –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `AddSession` —ñ middleware `UseSession()`                             |

---

### üßæ **2. –î–∞–Ω—ñ –∑ `appsettings.json` –≤–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ:**

–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ —Å–µ–∫—Ü—ñ—è:

```json
"StorageOptions": {
  "DefaultConnection": "...",
  "XmlFilePath": "..."
}
```

‚Äì –≤–∂–µ –±—É–ª–∞ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∞ –¥–æ `StorageOptions` (—á–µ—Ä–µ–∑ `Configure<StorageOptions>()`), —Ç–æ–º—É:

* `options.DefaultConnection` ‚Äî –≤–∂–µ –º–∞—î —Ä—è–¥–æ–∫ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è.
* `options.XmlFilePath` ‚Äî –≤–∂–µ –º–∞—î —à–ª—è—Ö –¥–æ XML-—Ñ–∞–π–ª—É.

---

### üóÇÔ∏è **3. –í–∏–∑–Ω–∞—á–µ–Ω–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ:**

```csharp
if (app.Environment.IsDevelopment()) ...
```

–¢–æ–±—Ç–æ:

* –£–≤—ñ–º–∫–Ω–µ–Ω–æ `DeveloperExceptionPage`, —è–∫—â–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ `Development`.
* –¢–≤—ñ–π –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –ø—Ä–∞—Ü—é—î –≤ —Ä–µ–∂–∏–º—ñ –≤—ñ–¥–ª–∞–¥–∫–∏ ‚Äî —Ç–æ–º—É `app.Environment.EnvironmentName == "Development"`.

---

### üß† **4. –ü—Ä–∞—Ü—é—î —Å–µ—Å—ñ—è (–∞–ª–µ —â–µ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞):**

* –°–µ—Ä–≤—ñ—Å `ISession` –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ.
* Middleware `app.UseSession()` —É–≤—ñ–º–∫–Ω—É—Ç–∏–π.
* –ê–ª–µ **—Å–∞–º –æ–±'—î–∫—Ç —Å–µ—Å—ñ—ó –ø–æ–∫–∏ —â–µ –Ω–µ –º—ñ—Å—Ç–∏—Ç—å –¥–∞–Ω–∏—Ö**, –±–æ —Ü–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ç–æ–≥–æ, —á–∏ –±—É–≤ –≤–∂–µ HTTP-–∑–∞–ø–∏—Ç, —ñ —á–∏ –±—É–ª–∞ –≤–∏–∫–ª–∏–∫–∞–Ω–∞ –ª–æ–≥—ñ–∫–∞, —â–æ —â–æ—Å—å —Ç—É–¥–∏ –∑–∞–ø–∏—Å–∞–ª–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `StorageType`).

–¢–æ–±—Ç–æ: —Å–µ—Å—ñ—è **–≥–æ—Ç–æ–≤–∞ –¥–æ —Ä–æ–±–æ—Ç–∏**, –∞–ª–µ `StorageSelectionService.GetCurrentStorageType()` –ø–æ–∫–∏ –Ω—ñ—á–æ–≥–æ –Ω–µ –ø–æ–≤–µ—Ä–Ω–µ, —è–∫—â–æ —Ü–µ –Ω–µ –±—É–ª–æ —è–≤–Ω–æ –∑–∞–¥–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.

---

### üí° **5. –í–∏–±—ñ—Ä —Å—Ö–æ–≤–∏—â–∞ (`TaskRepository`) —â–µ –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ, —è–∫—â–æ –Ω–µ –±—É–ª–æ –∑–∞–ø–∏—Ç—É:**

```csharp
var storageService = provider.GetRequiredService<IStorageSelectionService>();
var storageType = storageService.GetCurrentStorageType(); // ‚Üê –¢—É—Ç –±—É–¥–µ Default –∞–±–æ Exception
```

–û—Ç–∂–µ:

* –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —â–µ –Ω–µ –≤–∏–∫–æ–Ω–∞–≤ –∂–æ–¥–Ω–æ—ó –¥—ñ—ó (–Ω–µ –∑—Ä–æ–±–∏–≤ –∑–∞–ø–∏—Ç —ñ–∑ –≤–∏–±–æ—Ä–æ–º —Ç–∏–ø—É –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è), `GetCurrentStorageType()` –º–æ–∂–µ –∫–∏–Ω—É—Ç–∏ `InvalidOperationException`, –∞–±–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º ‚Äî –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ç–≤–æ—î—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó.

---

### üîç **6. –ú–∞—Ä—à—Ä—É—Ç–∏ –≤–∂–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ:**

* –°—Ç–∞—Ä—Ç–æ–≤–∏–π –º–∞—Ä—à—Ä—É—Ç —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä `TaskController.Index` –≤–∂–µ –∞–∫—Ç–∏–≤–Ω–∏–π.
* –Ø–∫—â–æ –≤—ñ–¥–∫—Ä–∏—î—à —É –±—Ä–∞—É–∑–µ—Ä—ñ `/`, –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ GET-–∑–∞–ø–∏—Ç –Ω–∞ `TaskController.Index()`.

---

### üì¶ **–°—Ç–∞–Ω –æ—Å–Ω–æ–≤–Ω–∏—Ö –æ–±‚Äô—î–∫—Ç—ñ–≤ —É –¥–µ–±–∞–∑—ñ:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç               | –°—Ç–∞–Ω —É debug-—Ä–µ–∂–∏–º—ñ               |
| ----------------------- | --------------------------------- |
| `builder.Configuration` | –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ `appsettings.json`    |
| `builder.Services`      | –£—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ         |
| `WebApplication`        | –ü–æ–±—É–¥–æ–≤–∞–Ω–∏–π (`builder.Build()`)   |
| Middleware (pipeline)   | HTTPS, Routing, Session, Auth     |
| –°–µ—Å—ñ—è (ISession)        | –ì–æ—Ç–æ–≤–∞, –∞–ª–µ —â–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—è  |
| `ITaskRepository`       | –ë—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø–∏—Ç—ñ |
| `app.Environment`       | `Development` (–≤–∫–ª—é—á–µ–Ω–æ debug UI) |

---

üîú –Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî –º–æ–∂—É –ø–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ `Immediate Window`, `Watch` –∞–±–æ `Locals` –≤ debug-—Ä–µ–∂–∏–º—ñ.
–ß–µ–∫–∞—é –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥ –∞–±–æ –∑–∞–ø–∏—Ç.
